<div class="callout callout-info no-subheader">
    <div class="header">
        <i class="icon-info"></i>
        <h3>How to retrieve your credentials</h3>
    </div>
    <div class="content">
        <ol dir="auto">
            <li>
                <p dir="auto">Create an
                    <code>App ID</code> for your website (<a href="https://developer.apple.com/account/resources/identifiers/list/bundleId" rel="nofollow">https://developer.apple.com/account/resources/identifiers/list/bundleId</a>) with the following details:
                </p>
                <ul dir="auto">
                    <li>Platform: iOS, tvOS, watchOS (I'm unsure if either choice has an effect for web apps)</li>
                    <li>Description: (something like "example.com app id")</li>
                    <li>Bundle ID (Explicit): com.example.id (or something similar)</li>
                    <li>Check "Sign In With Apple"</li>
                </ul>
            </li>
            <li>
                <p dir="auto">Create a
                    <code>Service ID</code> for your website (<a href="https://developer.apple.com/account/resources/identifiers/list/serviceId" rel="nofollow">https://developer.apple.com/account/resources/identifiers/list/serviceId</a>) with the following details:
                </p>
                <ul dir="auto">
                    <li>Description: (something like "example.com service id")</li>
                    <li>Identifier: com.example.service (or something similar)</li>
                    <li>Check "Sign In With Apple"</li>
                    <li>Configure "Sign In With Apple":
                        <ul dir="auto">
                            <li>Primary App Id: (select the primary app id created in step 1)</li>
                            <li>Web Domain: example.com (the domain of your web site)</li>
                            <li>Return URLs:
                                <a href="https://example.com/apple-signin" rel="nofollow">https://example.com/apple-signin</a> (the route pointing to the callback method in your controller)
                            </li>
                            <li>Click "Save".</li>
                            <li>Click the "Edit" button to edit the details of the "Sign In With Apple"
                                configuration we just created.
                            </li>
                            <li>If you haven't verified the domain yet, download the verification file,
                                upload it to
                                <a href="https://example.com/.well-known/apple-developer-domain-association.txt" rel="nofollow">https://example.com/.well-known/apple-developer-domain-association.txt</a>, and then click the "Verify"
                                button.
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>
                <p dir="auto">Create a
                    <code>Private Key</code> for your website (<a href="https://developer.apple.com/account/resources/authkeys/list" rel="nofollow">https://developer.apple.com/account/resources/authkeys/list</a>) with the following details:
                </p>
                <ul dir="auto">
                    <li>Key Name:</li>
                    <li>Check "Sign In With Apple"</li>
                    <li>Configure "Sign In With Apple":
                        <ul dir="auto">
                            <li>Primary App ID: (select the primary app id created in step 1)</li>
                            <li>Click "Save"</li>
                        </ul>
                    </li>
                    <li>Click "Continue"</li>
                    <li>Click "Register"</li>
                    <li>Click "Download"</li>
                    <li>Rename the downloaded file to <code>key.txt</code></li>
                </ul>
            </li>
            <li>
                <p dir="auto">Create your app's client secret:</p>
                <ul dir="auto">
                    <li>
                        <p dir="auto">Install the JWT Gem:</p>
                        <div class="highlight highlight-source-shell position-relative overflow-auto">
                            <pre>sudo gem install jwt</pre>
                            <div class="zeroclipboard-container position-absolute right-0 top-0">
                                <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay" data-copy-feedback="Copied!" data-tooltip-direction="w" value="sudo gem install jwt" tabindex="0" role="button" style="display: none;">
                                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
                                        <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
                                        <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
                                    </svg>
                                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
                                        <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                                    </svg>
                                </clipboard-copy>
                            </div>
                        </div>
                    </li>
                    <li>
                        <p dir="auto">Create a file called <code>client_secret.rb</code> to process the private key:</p>
                        <div class="highlight highlight-source-ruby position-relative overflow-auto"><pre><span class="pl-en">require</span> <span class="pl-s">'jwt'</span>

<span class="pl-s1">key_file</span> <span class="pl-c1">=</span> <span class="pl-s">'key.txt'</span>
<span class="pl-s1">team_id</span> <span class="pl-c1">=</span> <span class="pl-s">''</span>
<span class="pl-s1">client_id</span> <span class="pl-c1">=</span> <span class="pl-s">''</span>
<span class="pl-s1">key_id</span> <span class="pl-c1">=</span> <span class="pl-s">''</span>

<span class="pl-s1">ecdsa_key</span> <span class="pl-c1">=</span> <span class="pl-v">OpenSSL</span>::<span class="pl-v">PKey</span>::<span class="pl-c1">EC</span><span class="pl-kos">.</span><span class="pl-en">new</span> <span class="pl-c1">IO</span><span class="pl-kos">.</span><span class="pl-en">read</span> <span class="pl-s1">key_file</span>

<span class="pl-s1">headers</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
<span class="pl-s">'kid'</span> <span class="pl-c1">=&gt;</span> <span class="pl-s1">key_id</span>
<span class="pl-kos">}</span>

<span class="pl-s1">claims</span> <span class="pl-c1">=</span> <span class="pl-kos">{</span>
    <span class="pl-s">'iss'</span> <span class="pl-c1">=&gt;</span> <span class="pl-s1">team_id</span><span class="pl-kos">,</span>
    <span class="pl-s">'iat'</span> <span class="pl-c1">=&gt;</span> <span class="pl-v">Time</span><span class="pl-kos">.</span><span class="pl-en">now</span><span class="pl-kos">.</span><span class="pl-en">to_i</span><span class="pl-kos">,</span>
    <span class="pl-s">'exp'</span> <span class="pl-c1">=&gt;</span> <span class="pl-v">Time</span><span class="pl-kos">.</span><span class="pl-en">now</span><span class="pl-kos">.</span><span class="pl-en">to_i</span> + <span class="pl-c1">86400</span>*<span class="pl-c1">180</span><span class="pl-kos">,</span>
    <span class="pl-s">'aud'</span> <span class="pl-c1">=&gt;</span> <span class="pl-s">'https://appleid.apple.com'</span><span class="pl-kos">,</span>
    <span class="pl-s">'sub'</span> <span class="pl-c1">=&gt;</span> <span class="pl-s1">client_id</span><span class="pl-kos">,</span>
<span class="pl-kos">}</span>

<span class="pl-s1">token</span> <span class="pl-c1">=</span> <span class="pl-c1">JWT</span><span class="pl-kos">.</span><span class="pl-en">encode</span> <span class="pl-s1">claims</span><span class="pl-kos">,</span> <span class="pl-s1">ecdsa_key</span><span class="pl-kos">,</span> <span class="pl-s">'ES256'</span><span class="pl-kos">,</span> <span class="pl-s1">headers</span>

<span class="pl-en">puts</span> <span class="pl-s1">token</span></pre>
                            <div class="zeroclipboard-container position-absolute right-0 top-0">
                                <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay" data-copy-feedback="Copied!" data-tooltip-direction="w" value="require 'jwt'

key_file = 'key.txt'
team_id = ''
client_id = ''
key_id = ''

ecdsa_key = OpenSSL::PKey::EC.new IO.read key_file

headers = {
'kid' => key_id
}

claims = {
    'iss' => team_id,
    'iat' => Time.now.to_i,
    'exp' => Time.now.to_i + 86400*180,
    'aud' => 'https://appleid.apple.com',
    'sub' => client_id,
}

token = JWT.encode claims, ecdsa_key, 'ES256', headers

puts token" tabindex="0" role="button" style="display: none;">
                                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
                                        <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
                                        <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
                                    </svg>
                                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
                                        <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                                    </svg>
                                </clipboard-copy>
                            </div>
                        </div>
                    </li>
                    <li>
                        <p dir="auto">Fill in the following fields:</p>
                        <ul dir="auto">
                            <li><code>team_id</code>: This can be found on the top-right corner when logged into
                                your Apple Developer account, right under your name.
                            </li>
                            <li><code>client_id</code>: This is the identifier from the Service Id created in step
                                2 above, for example com.example.service
                            </li>
                            <li><code>key_id</code>: This is the identifier of the private key created in step 3
                                above.
                            </li>
                        </ul>
                    </li>
                    <li>
                        <p dir="auto">Save the file and run it from the terminal. It will spit out a JWT which is
                            your client secret, which you will need to add to your <code>.env</code> file in the
                            next step.</p>
                        <div class="highlight highlight-source-shell position-relative overflow-auto">
                            <pre>ruby client_secret.rb</pre>
                            <div class="zeroclipboard-container position-absolute right-0 top-0">
                                <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay" data-copy-feedback="Copied!" data-tooltip-direction="w" value="ruby client_secret.rb" tabindex="0" role="button">
                                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
                                        <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
                                        <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
                                    </svg>
                                    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
                                        <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                                    </svg>
                                </clipboard-copy>
                            </div>
                        </div>
                    </li>
                </ul>
            </li>
            <li>
                <p dir="auto">Set the necessary environment variables in your <code>.env</code> file:</p>
                <div class="highlight highlight-source-shell position-relative overflow-auto"><pre>SIGN_IN_WITH_APPLE_LOGIN=<span class="pl-s"><span class="pl-pds">"</span>/apple/login/controller/login/action<span class="pl-pds">"</span></span>
SIGN_IN_WITH_APPLE_REDIRECT=<span class="pl-s"><span class="pl-pds">"</span>/apple/login/controller/callback/action<span class="pl-pds">"</span></span>
SIGN_IN_WITH_APPLE_CLIENT_ID=<span class="pl-s"><span class="pl-pds">"</span>your app's service id as registered with Apple<span class="pl-pds">"</span></span>
SIGN_IN_WITH_APPLE_CLIENT_SECRET=<span class="pl-s"><span class="pl-pds">"</span>your app's client secret as calculated in step 4<span class="pl-pds">"</span></span></pre>
                    <div class="zeroclipboard-container position-absolute right-0 top-0">
                        <clipboard-copy aria-label="Copy" class="ClipboardButton btn js-clipboard-copy m-2 p-0 tooltipped-no-delay" data-copy-feedback="Copied!" data-tooltip-direction="w" value="SIGN_IN_WITH_APPLE_LOGIN=&quot;/apple/login/controller/login/action&quot;
SIGN_IN_WITH_APPLE_REDIRECT=&quot;/apple/login/controller/callback/action&quot;
SIGN_IN_WITH_APPLE_CLIENT_ID=&quot;your app's service id as registered with Apple&quot;
SIGN_IN_WITH_APPLE_CLIENT_SECRET=&quot;your app's client secret as calculated in step 4&quot;" tabindex="0" role="button">
                            <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-copy js-clipboard-copy-icon m-2">
                                <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
                                <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
                            </svg>
                            <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-fg-success d-none m-2">
                                <path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                            </svg>
                        </clipboard-copy>
                    </div>
                </div>
            </li>
        </ol>
    </div>
</div>
